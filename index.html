<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, user-scalable=1">
    <title>0330</title>
    <style>
      body {
        background-color: #f5f5f5;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .chartCard {
        width: 100%;
        padding: 0 20px;
      }
      .chartBox {
        width: 100%;
        max-width: 1200px;
        padding: 50px 0;
        display: flex;
        margin: 50px auto 0 auto;
        background-color: #fff;
        border-radius: 20px;
      }
      .colSmall {
        width: 35px;
      }
      .colLarge {
        max-width: 1200px;
        overflow-x: scroll;
        padding: 0 10px 0 0;
        /* margin: 0 5px; */
      }
      .box {
        width: calc(1500px - 35px);
        height: 500px;
      }
    </style>
  </head>
  <body>

    <div>
      <h1>그래프</h1>
    </div>

    <div class="chartCard">
      <div class="chartBox">
        <div class="colSmall">
          <canvas id="myChart2"></canvas>
        </div>
        <div class="colLarge">
          <div class="box">
            <canvas id="myChart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.0.0/chartjs-plugin-datalabels.min.js" integrity="sha512-R/QOHLpV1Ggq22vfDAWYOaMd5RopHrJNMxi8/lJu8Oihwi4Ho4BRFeiMiCefn9rasajKjnx9/fTQ/xkWnkDACg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- 그래프에 data 숫자로 보여주게 하고프면 플러그인 필요함 -->
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/1.0.1/chartjs-plugin-zoom.min.js" integrity="sha512-b+q5md1qwYUeYsuOBx+E8MzhsDSZeoE80dPP1VCw9k/KA9LORQmaH3RuXjlpu3u1rfUwh7s6SHthZM3sUGzCkA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.0/chartjs-plugin-zoom.min.js" integrity="sha512-B6F98QATBNaDHSE7uANGo5h0mU6fhKCUD+SPAY7KZDxE8QgZw9rewDtNiu3mbbutYDWOKT3SPYD8qDBpG2QnEg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
    //주의점!.!
    //가로스크롤 부분 때문에 data 변수가 2개이므로 data와 data2라는 변수에 항상 같은 데이터를 넣어야 함.
    //data의 o,c,s의 데이터가 정확하지 않으면 color가 제대로 적용되어 표현되지 않음.
    //o는 opening = 첫번째 데이터, c는 closing = 두번째 데이터입니다. s에 o와 c의 데이터를 정확하게 입력해야만 합니다.


    // 데이터 setup 
    const data = {
      datasets: [{
        data: [
          {
            x: '0323', o: 0, c: -20, s: [0, -20]
          },
          {
            x: '0324', o: -20, c: 80, s: [-20, 80]
          },
          {
            x: '0325', o: 80, c: 50, s: [80, 50]
          },
          {
            x: '0326', o: 50, c: 60, s: [50, 60]
          },
          {
            x: '0327', o: 60, c: 100, s: [60, 100]
          },
          {
            x: '0328', o: 100, c: 80, s: [100, 80]
          },
          {
            x: '0329', o: 80, c: 50, s: [80, 50]
          },
          {
            x: '0330', o: 50, c: 30, s: [50, 30]
          },
          {
            x: '0331', o: 30, c: 130, s: [30, 130]
          },
          {
            x: '0401', o: 130, c: 50, s: [130, 50]
          },
          {
            x: '0402', o: 50, c: 80, s: [50, 80]
          },
          {
            x: '0403', o: 80, c: -50, s: [80, -50]
          },
          {
            x: '0404', o: -50, c: -30, s: [-50, -30]
          },
          {
            x: '0405', o: -30, c: 50, s: [-30, 50]
          },
          {
            x: '0406', o: 50, c: 80, s: [50, 80]
          },
          {
            x: '0407', o: 80, c: 0, s: [80, 0]
          },
          {
            x: '0408', o: 0, c: 20, s: [0, 20]
          },
          {
            x: '0409', o: 20, c: 30, s: [20, 30]
          },
          {
            x: '0410', o: 30, c: 65, s: [30, 65]
          },
          {
            x: '0411', o: 65, c: 35, s: [65, 35]
          },
          {
            x: '0412', o: 35, c: 80, s: [35, 80]
          },
          {
            x: '0413', o: 80, c: 65, s: [80, 65]
          },
          {
            x: '0414', o: 65, c: 60, s: [65, 60]
          },
        ],
        backgroundColor: [],
        barThickness: 40,
      }]
    };
    // console.log(data.datasets[0].data[0].o);
    console.log(data.datasets[0].data.length);
    // console.log(data.datasets[0].backgroundColor);

    //data 갯수
    let dataLength = data.datasets[0].data.length;

    for(let i=0; i<dataLength; i++) {
      if (data.datasets[0].data[i].o < data.datasets[0].data[i].c) {
        data.datasets[0].backgroundColor.push('#F7464A');
      }
      if (data.datasets[0].data[i].o > data.datasets[0].data[i].c) {
        data.datasets[0].backgroundColor.push('#1E90FF');
      }
    }



    // width 설정
    if (dataLength > 22) {
      let box = document.querySelector('.box');
      box.style.setProperty('width', dataLength * 68 + `px`);
    }


    // config 
    const config = {
      type: 'bar',
      data,
      options: {
        maintainAspectRatio: false,
        layout: {
          padding: {
            top: 10,
            bottom: 15,
          }
        },
        parsing: {
          yAxisKey: 's',
        },
        scales: {
          x: {
            barPercentage: 0.4,
            ticks: {
              font: {
                size: 14,
                weight: 'bold',
              },
              color: '#000',
            }
          },
          y: {
            beginAtZero: true,
            ticks: {
              display: false,
            },
          }
        },
        plugins: {
          legend: {
            display: false,
          },
          datalabels: {
            anchor: 'end',
            align: 'top',
            formatter: (val) => {
              return val.c
              //그래프 bar 위에 숫자 표현(c)
            }
          },
          zoom: {
            pan: {
              enabled: true,
              mode: 'xy',
              threshold: 5,
            },
            zoom: {
              wheel: {
                enabled: true,
              },
              pinch: {
                enabled: true,
              },
              mode: 'xy'
            }

          }
        },
      },
      plugins: [ChartDataLabels]
    };

    // 렌더링
    const myChart = new Chart(
      document.getElementById('myChart'),
      config
    );

    // if (myChart.data.datasets[0].data.length > 8) {
    //   myChart.config.data.labels.shift();
    //   myChart.config.data.datasets[0].data.shift()
    // }




    //Chart2 (가로스크롤에서 계속 y축 수치가 보이게 하기 위한 차트2)
    // 차트2 데이터 setup 
    const data2 = {
      datasets: [{
        data: [
          {
            x: '0323', o: 0, c: -20, s: [0, -20]
          },
          {
            x: '0324', o: -20, c: 80, s: [-20, 80]
          },
          {
            x: '0325', o: 80, c: 50, s: [80, 50]
          },
          {
            x: '0326', o: 50, c: 60, s: [50, 60]
          },
          {
            x: '0327', o: 60, c: 100, s: [60, 100]
          },
          {
            x: '0328', o: 100, c: 80, s: [100, 80]
          },
          {
            x: '0329', o: 80, c: 50, s: [80, 50]
          },
          {
            x: '0330', o: 50, c: 30, s: [50, 30]
          },
          {
            x: '0331', o: 30, c: 130, s: [30, 130]
          },
          {
            x: '0401', o: 130, c: 50, s: [130, 50]
          },
          {
            x: '0402', o: 50, c: 80, s: [50, 80]
          },
          {
            x: '0403', o: 80, c: -50, s: [80, -50]
          },
          {
            x: '0404', o: -50, c: -30, s: [-50, -30]
          },
          {
            x: '0405', o: -30, c: 50, s: [-30, 50]
          },
          {
            x: '0406', o: 50, c: 80, s: [50, 80]
          },
          {
            x: '0407', o: 80, c: 0, s: [80, 0]
          },
          {
            x: '0408', o: 0, c: 20, s: [0, 20]
          },
          {
            x: '0409', o: 20, c: 20, s: [20, 20]
          },
          {
            x: '0410', o: 20, c: 65, s: [20, 65]
          },
        ],
        backgroundColor: [],
      }]
    };

    // 차트2 config 
    const config2 = {
      type: 'bar',
      data: data2,
      options: {
        maintainAspectRatio: false,
        layout: {
          padding: {
            bottom: 44
          }
        },
        parsing: {
          yAxisKey: 's',
        },
        scales: {
          x: {
            ticks: {
              display: false,
            },
            grid: {
              drawTicks: false,
            }
          },
          y: {
            beginAtZero: true,
            afterFit: (ctx) => {
              ctx.width = 35;
            },
            grid: {
              drawTicks: false,
            },
          }
        },
        plugins: {
          legend: {
            display: false,
        },
        },
      }
    };
    // 차트2 렌더링
    const myChart2 = new Chart(
      document.getElementById('myChart2'),
      config2
    );
    
    </script>

  </body>
</html>